

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting started with python scripting for MOOSE &mdash; MOOSE ChamCham (3.1.1) documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="MOOSE ChamCham (3.1.1) documentation" href="../../../index.html"/>
        <link rel="up" title="Quick Start" href="index_qs.html"/>
        <link rel="next" title="Cook Book" href="../cookbook/index_ckbk.html"/>
        <link rel="prev" title="MOOSE GUI: Graphical interface for MOOSE" href="qs_GUI.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> MOOSE
          

          
            
            <img src="../../../_static/moose_logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../install/index_install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index_qs.html">Quick Start</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="qs_GUI.html">MOOSE GUI: Graphical interface for MOOSE</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Getting started with python scripting for MOOSE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#importing-moose-and-accessing-built-in-documentation">Importing MOOSE and accessing built-in documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-objects-and-traversing-the-object-hierarchy">Creating objects and traversing the object hierarchy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setting-the-properties-of-elements-accessing-fields">Setting the properties of elements: accessing fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#putting-them-together-setting-up-connections">Putting them together: setting up connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scheduling">Scheduling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-simulation">Running the simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#some-more-details">Some more details</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vec-melement-and-element"><code class="docutils literal"><span class="pre">vec</span></code>, <code class="docutils literal"><span class="pre">melement</span></code> and <code class="docutils literal"><span class="pre">element</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#finfos"><code class="docutils literal"><span class="pre">Finfos</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#moving-on">Moving on</a></li>
<li class="toctree-l3"><a class="reference internal" href="#demonstration-of-basic-functionalities">Demonstration of basic functionalities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#module-helloMoose">Load and Run a Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-startstop">Start, Stop, and setting clocks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-pyrun">Run Python from MOOSE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#moose-classes">MOOSE Classes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook/index_ckbk.html">Cook Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../graphics/index_graphics.html">Graphics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes/index.html">Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_issues/index.html">Known issues</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">MOOSE</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index_qs.html">Quick Start</a> &raquo;</li>
      
    <li>Getting started with python scripting for MOOSE</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/user/py/quickstart/moose_quickstart.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started-with-python-scripting-for-moose">
<h1>Getting started with python scripting for MOOSE<a class="headerlink" href="#getting-started-with-python-scripting-for-moose" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id11">Introduction</a></li>
<li><a class="reference internal" href="#importing-moose-and-accessing-built-in-documentation" id="id12">Importing MOOSE and accessing built-in documentation</a></li>
<li><a class="reference internal" href="#setting-the-properties-of-elements-accessing-fields" id="id13">Setting the properties of elements: accessing fields</a></li>
<li><a class="reference internal" href="#putting-them-together-setting-up-connections" id="id14">Putting them together: setting up connections</a></li>
<li><a class="reference internal" href="#scheduling" id="id15">Scheduling</a></li>
<li><a class="reference internal" href="#running-the-simulation" id="id16">Running the simulation</a></li>
<li><a class="reference internal" href="#some-more-details" id="id17">Some more details</a></li>
<li><a class="reference internal" href="#moving-on" id="id18">Moving on</a></li>
<li><a class="reference internal" href="#demonstration-of-basic-functionalities" id="id19">Demonstration of basic functionalities</a></li>
</ul>
</div>
<div class="section" id="introduction">
<span id="quickstart-intro"></span><h2><a class="toc-backref" href="#id11">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document describes how to use the <code class="docutils literal"><span class="pre">moose</span></code> module in Python
scripts or in an interactive Python shell. It aims to give you enough
overview to help you start scripting using MOOSE and extract farther
information that may be required for advanced work. Knowledge of
Python or programming in general will be helpful. If you just want to
simulate existing models in one of the supported formats, you can fire
the MOOSE GUI and locate the model file using the <code class="docutils literal"><span class="pre">File</span></code> menu and
load it. The GUI is described in separate document. If you
are looking for recipes for specific tasks, take a look at
<span class="xref doc">moose_cookbook</span>. The example code in the boxes can be entered in
a Python shell.</p>
</div>
<div class="section" id="importing-moose-and-accessing-built-in-documentation">
<span id="quickstart-importing"></span><h2><a class="toc-backref" href="#id12">Importing MOOSE and accessing built-in documentation</a><a class="headerlink" href="#importing-moose-and-accessing-built-in-documentation" title="Permalink to this headline">¶</a></h2>
<p>In a python script you import modules to access the functionalities they
provide.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">moose</span>
</pre></div>
</div>
<p>This makes the <code class="docutils literal"><span class="pre">moose</span></code> module available for use in Python. You can use
Python&#8217;s built-in <code class="docutils literal"><span class="pre">help</span></code> function to read the top-level documentation
for the moose module</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">moose</span><span class="p">)</span>
</pre></div>
</div>
<p>This will give you an overview of the module. Press <code class="docutils literal"><span class="pre">q</span></code> to exit the
pager and get back to the interpreter. You can also access the
documentation for individual classes and functions this way.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">)</span>
</pre></div>
</div>
<p>To list the available functions and classes you can use <code class="docutils literal"><span class="pre">dir</span></code>
function <a class="footnote-reference" href="#id5" id="id1">[1]</a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">dir</span><span class="p">(</span><span class="n">moose</span><span class="p">)</span>
</pre></div>
</div>
<p>MOOSE has built-in documentation in the C++-source-code independent of
Python. The <code class="docutils literal"><span class="pre">moose</span></code> module has a separate <code class="docutils literal"><span class="pre">doc</span></code> function to extract
this documentation.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">doc</span><span class="p">(</span><span class="n">moose</span><span class="o">.</span><span class="n">Compartment</span><span class="p">)</span>
</pre></div>
</div>
<p>The class level documentation will show whatever the author/maintainer
of the class wrote for documentation followed by a list of various kinds
of fields and their data types. This can be very useful in an
interactive session.</p>
<p>Each field can have its own detailed documentation, too.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">doc</span><span class="p">(</span><span class="s1">&#39;Compartment.Rm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that you need to put the class-name followed by dot followed by
field-name within quotes. Otherwise, <code class="docutils literal"><span class="pre">moose.doc</span></code> will receive the
field value as parameter and get confused.</p>
<div class="section" id="creating-objects-and-traversing-the-object-hierarchy">
<span id="quickstart-creating"></span><h3>Creating objects and traversing the object hierarchy<a class="headerlink" href="#creating-objects-and-traversing-the-object-hierarchy" title="Permalink to this headline">¶</a></h3>
<p>Different types of biological entities like neurons, enzymes, etc are
represented by classes and individual instances of those types are
objects of those classes. Objects are the building-blocks of models in
MOOSE. We call MOOSE objects <code class="docutils literal"><span class="pre">element</span></code> and use object and element
interchangeably in the context of MOOSE. Elements are conceptually laid
out in a tree-like hierarchical structure. If you are familiar with file
system hierarchies in common operating systems, this should be simple.</p>
<p>At the top of the object hierarchy sits the <code class="docutils literal"><span class="pre">Shell</span></code>, equivalent to the
root directory in UNIX-based systems and represented by the path <code class="docutils literal"><span class="pre">/</span></code>.
You can list the existing objects under <code class="docutils literal"><span class="pre">/</span></code> using the <code class="docutils literal"><span class="pre">le</span></code> function.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">le</span><span class="p">()</span>
<span class="go">Elements under /</span>
<span class="go">/Msgs</span>
<span class="go">/clock</span>
<span class="go">/classes</span>
<span class="go">/postmaster</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">Msgs</span></code>, <code class="docutils literal"><span class="pre">clock</span></code> and <code class="docutils literal"><span class="pre">classes</span></code> are predefined objects in MOOSE. And
each object can contain other objects inside them. You can see them by
passing the path of the parent object to <code class="docutils literal"><span class="pre">le</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="s1">&#39;/Msgs&#39;</span><span class="p">)</span>
<span class="go">Elements under /Msgs[0]</span>
<span class="go">/Msgs[0]/singleMsg</span>
<span class="go">/Msgs[0]/oneToOneMsg</span>
<span class="go">/Msgs[0]/oneToAllMsg</span>
<span class="go">/Msgs[0]/diagonalMsg</span>
<span class="go">/Msgs[0]/sparseMsg</span>
</pre></div>
</div>
<p>Now let us create some objects of our own. This can be done by invoking
MOOSE class constructors (just like regular Python classes).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span><span class="s1">&#39;/model&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The above creates a <code class="docutils literal"><span class="pre">Neutral</span></code> object named <code class="docutils literal"><span class="pre">model</span></code>. <code class="docutils literal"><span class="pre">Neutral</span></code> is
the most basic class in MOOSE. A <code class="docutils literal"><span class="pre">Neutral</span></code> element can act as a
container for other elements. We can create something under <code class="docutils literal"><span class="pre">model</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">soma</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Compartment</span><span class="p">(</span><span class="s1">&#39;/model/soma&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Every element has a unique path. This is a concatenation of the names of
all the objects one has to traverse starting with the root to reach that
element.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">soma</span><span class="o">.</span><span class="n">path</span>
<span class="go">/model/soma</span>
</pre></div>
</div>
<p>The name of the element can be printed, too.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">soma</span><span class="o">.</span><span class="n">name</span>
<span class="go">soma</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">Compartment</span></code> elements model small sections of a neuron. Some
basic experiments can be carried out using a single compartment. Let us
create another object to act on the <code class="docutils literal"><span class="pre">soma</span></code>. This will be a step
current generator to inject a current pulse into the soma.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pulse</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">PulseGen</span><span class="p">(</span><span class="s1">&#39;/model/pulse&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can use <code class="docutils literal"><span class="pre">le</span></code> at any point to see what is there</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="s1">&#39;/model&#39;</span><span class="p">)</span>
<span class="go">Elements under /model</span>
<span class="go">/model/soma</span>
<span class="go">/model/pulse</span>
</pre></div>
</div>
<p>And finally, we can create a <code class="docutils literal"><span class="pre">Table</span></code> to record the time series of the
soma&#8217;s membrane potential. It is good practice to organize the data
separately from the model. So we do it as below</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span><span class="s1">&#39;/data&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vmtab</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;/data/soma_Vm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have the essential elements for a small model, we can go on
to set the properties of this model and the experimental protocol.</p>
</div>
</div>
<div class="section" id="setting-the-properties-of-elements-accessing-fields">
<span id="quickstart-properties"></span><h2><a class="toc-backref" href="#id13">Setting the properties of elements: accessing fields</a><a class="headerlink" href="#setting-the-properties-of-elements-accessing-fields" title="Permalink to this headline">¶</a></h2>
<p>Elements have several kinds of fields. The simplest ones are the
<code class="docutils literal"><span class="pre">value</span> <span class="pre">fields</span></code>. These can be accessed like ordinary Python members.
You can list the available value fields using <code class="docutils literal"><span class="pre">getFieldNames</span></code>
function</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">soma</span><span class="o">.</span><span class="n">getFieldNames</span><span class="p">(</span><span class="s1">&#39;valueFinfo&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here <code class="docutils literal"><span class="pre">valueFinfo</span></code> is the type name for value fields. <code class="docutils literal"><span class="pre">Finfo</span></code> is
short form of <em>field information</em>. For each type of field there is a
name ending with <code class="docutils literal"><span class="pre">-Finfo</span></code>. The above will display the following
list</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="p">(</span><span class="s1">&#39;this&#39;</span><span class="p">,</span>
<span class="s1">&#39;name&#39;</span><span class="p">,</span>
<span class="s1">&#39;me&#39;</span><span class="p">,</span>
<span class="s1">&#39;parent&#39;</span><span class="p">,</span>
<span class="s1">&#39;children&#39;</span><span class="p">,</span>
<span class="s1">&#39;path&#39;</span><span class="p">,</span>
<span class="s1">&#39;class&#39;</span><span class="p">,</span>
<span class="s1">&#39;linearSize&#39;</span><span class="p">,</span>
<span class="s1">&#39;objectDimensions&#39;</span><span class="p">,</span>
<span class="s1">&#39;lastDimension&#39;</span><span class="p">,</span>
<span class="s1">&#39;localNumField&#39;</span><span class="p">,</span>
<span class="s1">&#39;pathIndices&#39;</span><span class="p">,</span>
<span class="s1">&#39;msgOut&#39;</span><span class="p">,</span>
<span class="s1">&#39;msgIn&#39;</span><span class="p">,</span>
<span class="s1">&#39;Vm&#39;</span><span class="p">,</span>
<span class="s1">&#39;Cm&#39;</span><span class="p">,</span>
<span class="s1">&#39;Em&#39;</span><span class="p">,</span>
<span class="s1">&#39;Im&#39;</span><span class="p">,</span>
<span class="s1">&#39;inject&#39;</span><span class="p">,</span>
<span class="s1">&#39;initVm&#39;</span><span class="p">,</span>
<span class="s1">&#39;Rm&#39;</span><span class="p">,</span>
<span class="s1">&#39;Ra&#39;</span><span class="p">,</span>
<span class="s1">&#39;diameter&#39;</span><span class="p">,</span>
<span class="s1">&#39;length&#39;</span><span class="p">,</span>
<span class="s1">&#39;x0&#39;</span><span class="p">,</span>
<span class="s1">&#39;y0&#39;</span><span class="p">,</span>
<span class="s1">&#39;z0&#39;</span><span class="p">,</span>
<span class="s1">&#39;x&#39;</span><span class="p">,</span>
<span class="s1">&#39;y&#39;</span><span class="p">,</span>
<span class="s1">&#39;z&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Some of these fields are for internal or advanced use, some give access
to the physical properties of the biological entity we are trying to
model. Now we are interested in <code class="docutils literal"><span class="pre">Cm</span></code>, <code class="docutils literal"><span class="pre">Rm</span></code>, <code class="docutils literal"><span class="pre">Em</span></code> and <code class="docutils literal"><span class="pre">initVm</span></code>.
In the most basic form, a neuronal compartment acts like a parallel
<code class="docutils literal"><span class="pre">RC</span></code> circuit with a battery attached. Here <code class="docutils literal"><span class="pre">R</span></code> and <code class="docutils literal"><span class="pre">C</span></code> are
resistor and capacitor connected in parallel, and the battery with
voltage <code class="docutils literal"><span class="pre">Em</span></code> is in series with the resistor, as shown below:</p>
<div class="figure" id="id10">
<img alt="**Passive neuronal compartment**" src="../../../_images/neuronalcompartment.jpg" />
<p class="caption"><span class="caption-text"><strong>Passive neuronal compartment</strong></span></p>
</div>
<p>The fields are populated with some defaults.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">soma</span><span class="o">.</span><span class="n">Cm</span><span class="p">,</span> <span class="n">soma</span><span class="o">.</span><span class="n">Rm</span><span class="p">,</span> <span class="n">soma</span><span class="o">.</span><span class="n">Vm</span><span class="p">,</span> <span class="n">soma</span><span class="o">.</span><span class="n">Em</span><span class="p">,</span> <span class="n">soma</span><span class="o">.</span><span class="n">initVm</span>
<span class="go">1.0 1.0 -0.06 -0.06 -0.06</span>
</pre></div>
</div>
<p>You can set the <code class="docutils literal"><span class="pre">Cm</span></code> and <code class="docutils literal"><span class="pre">Rm</span></code> fields to something realistic using
simple assignment (we follow SI unit) <a class="footnote-reference" href="#id6" id="id2">[2]</a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">soma</span><span class="o">.</span><span class="n">Cm</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">soma</span><span class="o">.</span><span class="n">Rm</span> <span class="o">=</span> <span class="mf">1e7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">soma</span><span class="o">.</span><span class="n">initVm</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.07</span>
</pre></div>
</div>
<p>Instead of writing print statements for each field, you could use the
utility function showfield to see that the changes took effect</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">showfield</span><span class="p">(</span><span class="n">soma</span><span class="p">)</span>
<span class="go">[ /soma[0] ]</span>
<span class="go">diameter         = 0.0</span>
<span class="go">Ra               = 1.0</span>
<span class="go">y0               = 0.0</span>
<span class="go">Rm               = 10000000.0</span>
<span class="go">numData          = 1</span>
<span class="go">inject           = 0.0</span>
<span class="go">initVm           = -0.07</span>
<span class="go">Em               = -0.06</span>
<span class="go">y                = 0.0</span>
<span class="go">numField         = 1</span>
<span class="go">path             = /soma[0]</span>
<span class="go">dt               = 5e-05</span>
<span class="go">tick             = 4</span>
<span class="go">z0               = 0.0</span>
<span class="go">name             = soma</span>
<span class="go">Cm               = 1e-09</span>
<span class="go">x0               = 0.0</span>
<span class="go">Vm               = -0.06</span>
<span class="go">className        = Compartment</span>
<span class="go">length           = 0.0</span>
<span class="go">Im               = 0.0</span>
<span class="go">x                = 0.0</span>
<span class="go">z                = 0.0</span>
</pre></div>
</div>
<p>Now we can setup the current pulse to be delivered to the soma</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pulse</span><span class="o">.</span><span class="n">delay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">50e-3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pulse</span><span class="o">.</span><span class="n">width</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100e-3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pulse</span><span class="o">.</span><span class="n">level</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pulse</span><span class="o">.</span><span class="n">delay</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e9</span>
</pre></div>
</div>
<p>This tells the pulse generator to create a 100 ms long pulse 50 ms after
the start of the simulation. The amplitude of the pulse is set to 1 nA.
We set the delay for the next pulse to a very large value (larger than
the total simulation time) so that the stimulation stops after the first
pulse. Had we set <code class="docutils literal"><span class="pre">pulse.delay</span> <span class="pre">=</span> <span class="pre">0</span></code> , it would have generated a pulse
train at 50 ms intervals.</p>
</div>
<div class="section" id="putting-them-together-setting-up-connections">
<span id="quickstart-connections"></span><h2><a class="toc-backref" href="#id14">Putting them together: setting up connections</a><a class="headerlink" href="#putting-them-together-setting-up-connections" title="Permalink to this headline">¶</a></h2>
<p>In order for the elements to interact during simulation, we need to
connect them via messages. Elements are connected to each other using
special source and destination fields. These types are named
<code class="docutils literal"><span class="pre">srcFinfo</span></code> and <code class="docutils literal"><span class="pre">destFinfo</span></code>. You can query the available source and
destination fields on an element using <code class="docutils literal"><span class="pre">getFieldNames</span></code> as before. This
time, let us do it another way: by the class name</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">getFieldNames</span><span class="p">(</span><span class="s1">&#39;PulseGen&#39;</span><span class="p">,</span> <span class="s1">&#39;srcFinfo&#39;</span><span class="p">)</span>
<span class="go">(&#39;childMsg&#39;, &#39;output&#39;)</span>
</pre></div>
</div>
<p>This form has the advantage that you can get information about a class
without creating elements of that class.</p>
<p>Here <code class="docutils literal"><span class="pre">childMsg</span></code> is a source field that is used by the MOOSE internals
to connect child elements to parent elements. The second one is of our
interest. Check out the built-in documentation here</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">doc</span><span class="p">(</span><span class="s1">&#39;PulseGen.output&#39;</span><span class="p">)</span>
<span class="go">PulseGen.output: double - source field</span>
<span class="go">Current output level.</span>
</pre></div>
</div>
<p>so this is the output of the pulse generator and this must be injected
into the <code class="docutils literal"><span class="pre">soma</span></code> to stimulate it. But where in the <code class="docutils literal"><span class="pre">soma</span></code> can we send
it? Again, MOOSE has some introspection built in.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">soma</span><span class="o">.</span><span class="n">getFieldNames</span><span class="p">(</span><span class="s1">&#39;destFinfo&#39;</span><span class="p">)</span>
<span class="go">(&#39;parentMsg&#39;,</span>
<span class="go"> &#39;setThis&#39;,</span>
<span class="go"> &#39;getThis&#39;,</span>
<span class="go">   ...</span>
<span class="go"> &#39;setZ&#39;,</span>
<span class="go"> &#39;getZ&#39;,</span>
<span class="go"> &#39;injectMsg&#39;,</span>
<span class="go"> &#39;randInject&#39;,</span>
<span class="go"> &#39;cable&#39;,</span>
<span class="go"> &#39;process&#39;,</span>
<span class="go"> &#39;reinit&#39;,</span>
<span class="go"> &#39;initProc&#39;,</span>
<span class="go"> &#39;initReinit&#39;,</span>
<span class="go"> &#39;handleChannel&#39;,</span>
<span class="go"> &#39;handleRaxial&#39;,</span>
<span class="go"> &#39;handleAxial&#39;)</span>
</pre></div>
</div>
<p>Now that is a long list. But much of it are fields for internal or
special use. Anything that starts with <code class="docutils literal"><span class="pre">get</span></code> or <code class="docutils literal"><span class="pre">set</span></code> are internal
<code class="docutils literal"><span class="pre">destFinfo</span></code> used for accessing value fields (we shall use one of those
when setting up data recording). Among the rest <code class="docutils literal"><span class="pre">injectMsg</span></code> seems to
be the most likely candidate. Use the <code class="docutils literal"><span class="pre">connect</span></code> function to connect
the pulse generator output to the soma input</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">pulse</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="n">soma</span><span class="p">,</span> <span class="s1">&#39;injectMsg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">connect(source,</span> <span class="pre">source_field,</span> <span class="pre">dest,</span> <span class="pre">dest_field)</span></code> creates a
<code class="docutils literal"><span class="pre">message</span></code> from <code class="docutils literal"><span class="pre">source</span></code> element&#8217;s <code class="docutils literal"><span class="pre">source_field</span></code> field to <code class="docutils literal"><span class="pre">dest</span></code>
elements <code class="docutils literal"><span class="pre">dest_field</span></code> field and returns that message. Messages are
also elements. You can print them to see their identity</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">m</span>
<span class="go">&lt;moose.SingleMsg: id=5, dataId=733, path=/Msgs/singleMsg[733]&gt;</span>
</pre></div>
</div>
<p>You can print any element as above and the string representation will
show you the class, two numbers(<code class="docutils literal"><span class="pre">id</span></code> and <code class="docutils literal"><span class="pre">dataId</span></code>) uniquely
identifying it among all elements, and its path. You can get some more
information about a message</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">m</span><span class="o">.</span><span class="n">e1</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">e2</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">srcFieldsOnE1</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">destFieldsOnE2</span>
<span class="go">/model/pulse /model/soma (&#39;output&#39;,) (&#39;injectMsg&#39;,)</span>
</pre></div>
</div>
<p>will confirm what you already know.</p>
<p>A message element has fields <code class="docutils literal"><span class="pre">e1</span></code> and <code class="docutils literal"><span class="pre">e2</span></code> referring to the elements
it connects. For single one-directional messages these are source and
destination elements, which are <code class="docutils literal"><span class="pre">pulse</span></code> and <code class="docutils literal"><span class="pre">soma</span></code> respectively. The
next two items are lists of the field names which are connected by this
message.</p>
<p>You could also check which elements are connected to a particular field</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">soma</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="s1">&#39;injectMsg&#39;</span><span class="p">]</span>
<span class="go">[&lt;moose.vec: class=PulseGen, id=729,path=/model/pulse&gt;]</span>
</pre></div>
</div>
<p>Notice that the list contains something called vec. We discuss this
<a class="reference external" href="#some-more-details">later</a>. Also <code class="docutils literal"><span class="pre">neighbors</span></code> is a new kind of
field: <code class="docutils literal"><span class="pre">lookupFinfo</span></code> which behaves like a dictionary. Next we connect
the table to the soma to retrieve its membrane potential <code class="docutils literal"><span class="pre">Vm</span></code>. This is
where all those <code class="docutils literal"><span class="pre">destFinfo</span></code> starting with <code class="docutils literal"><span class="pre">get</span></code> or <code class="docutils literal"><span class="pre">set</span></code> come in
use. For each value field <code class="docutils literal"><span class="pre">X</span></code>, there is a <code class="docutils literal"><span class="pre">destFinfo</span></code> <code class="docutils literal"><span class="pre">get{X}</span></code> to
retrieve the value at simulation time. This is used by the table to
record the values <code class="docutils literal"><span class="pre">Vm</span></code> takes.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">vmtab</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">soma</span><span class="p">,</span> <span class="s1">&#39;getVm&#39;</span><span class="p">)</span>
<span class="go">&lt;moose.SingleMsg: id=5, dataIndex=0, path=/Msgs[0]/singleMsg[0]&gt;</span>
</pre></div>
</div>
<p>This finishes our model and recording setup. You might be wondering
about the source-destination relationship above. It is natural to think
that <code class="docutils literal"><span class="pre">soma</span></code> is the source of <code class="docutils literal"><span class="pre">Vm</span></code> values which should be sent to
<code class="docutils literal"><span class="pre">vmtab</span></code>. But here <code class="docutils literal"><span class="pre">requestOut</span></code> is a <code class="docutils literal"><span class="pre">srcFinfo</span></code> acting like a
reply card. This mode of obtaining data is called <em>pull</em> mode. <a class="footnote-reference" href="#id7" id="id3">[3]</a></p>
<p>You can skip the next section on fine control of the timing of updates
and read <a class="reference internal" href="#quickstart-running"><span class="std std-ref">Running the simulation</span></a>.</p>
</div>
<div class="section" id="scheduling">
<span id="quickstart-scheduling"></span><h2><a class="toc-backref" href="#id15">Scheduling</a><a class="headerlink" href="#scheduling" title="Permalink to this headline">¶</a></h2>
<p>With the model all set up, we have to schedule the
simulation. Different components in a model may have different rates
of update. For example, the dynamics of electrical components require
the update intervals to be of the order 0.01 ms whereas chemical
components can be as slow as 1 s. Also, the results may depend on the
sequence of the updates of different components. These issues are
addressed in MOOSE using a clock-based update scheme. Each model
component is scheduled on a clock tick (think of multiple hands of a
clock ticking at different intervals and the object being updated at
each tick of the corresponding hand). The scheduling also guarantees
the correct sequencing of operations. For example, your Table objects
should always be scheduled <em>after</em> the computations that they are
recording, otherwise they will miss the outcome of the latest calculation.</p>
<p>MOOSE has a central clock element (<code class="docutils literal"><span class="pre">/clock</span></code>) to manage
time. Clock has a set of <code class="docutils literal"><span class="pre">Tick</span></code> elements under it that take care of
advancing the state of each element with time as the simulation
progresses. Every element to be included in a simulation must be
assigned a tick. Each tick can have a different ticking interval
(<code class="docutils literal"><span class="pre">dt</span></code>) that allows different elements to be updated at different
rates.</p>
<p>By default, every object is assigned a clock tick with reasonable default
timesteps as soon it is created:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Class</span> <span class="nb">type</span>                      <span class="n">tick</span>    <span class="n">dt</span>
<span class="n">Electrical</span> <span class="n">computations</span><span class="p">:</span>        <span class="mi">0</span><span class="o">-</span><span class="mi">7</span>     <span class="mi">50</span> <span class="n">microseconds</span>
<span class="n">electrical</span> <span class="n">compartments</span><span class="p">,</span>
<span class="n">V</span> <span class="ow">and</span> <span class="n">ligand</span><span class="o">-</span><span class="n">gated</span> <span class="n">ion</span> <span class="n">channels</span><span class="p">,</span>
<span class="n">Calcium</span> <span class="n">conc</span> <span class="ow">and</span> <span class="n">Nernst</span><span class="p">,</span>
<span class="n">stimulus</span> <span class="n">generators</span> <span class="ow">and</span> <span class="n">tables</span><span class="p">,</span>
<span class="n">HSolve</span><span class="o">.</span>

<span class="n">Table</span> <span class="p">(</span><span class="n">to</span> <span class="n">plot</span> <span class="n">elec</span><span class="o">.</span> <span class="n">signals</span><span class="p">)</span>   <span class="mi">8</span>       <span class="mi">100</span> <span class="n">microseconds</span>

<span class="n">Diffusion</span> <span class="n">solver</span>                <span class="mi">10</span>      <span class="mf">0.01</span> <span class="n">seconds</span>
<span class="n">Chemical</span> <span class="n">computations</span><span class="p">:</span>          <span class="mi">11</span><span class="o">-</span><span class="mi">17</span>   <span class="mf">0.1</span> <span class="n">seconds</span>
<span class="n">Pool</span><span class="p">,</span> <span class="n">Reac</span><span class="p">,</span> <span class="n">Enz</span><span class="p">,</span> <span class="n">MMEnz</span><span class="p">,</span>
<span class="n">Func</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span>
<span class="n">Gsolve</span><span class="p">,</span> <span class="n">Ksolve</span><span class="p">,</span>
<span class="n">Stats</span> <span class="p">(</span><span class="n">to</span> <span class="n">do</span> <span class="n">stats</span> <span class="n">on</span> <span class="n">outputs</span><span class="p">)</span>

<span class="n">Table2</span> <span class="p">(</span><span class="n">to</span> <span class="n">plot</span> <span class="n">chem</span><span class="o">.</span> <span class="n">signals</span><span class="p">)</span>  <span class="mi">18</span>      <span class="mi">1</span> <span class="n">second</span>

<span class="n">HDF5DataWriter</span>                  <span class="mi">30</span>      <span class="mi">1</span> <span class="n">second</span>
<span class="n">Postmaster</span> <span class="p">(</span><span class="k">for</span> <span class="n">parallel</span>        <span class="mi">31</span>      <span class="mf">0.01</span> <span class="n">seconds</span>
<span class="n">computations</span><span class="p">)</span>
</pre></div>
</div>
<p>There are 32 available clock ticks. Numbers 20 to 29 are
unassigned so you can use them for whatever purpose you like.</p>
<p>If you want fine control over the scheduling, there are three things
you can do.</p>
<blockquote>
<div><ul class="simple">
<li>Alter the &#8216;tick&#8217; field on the object</li>
<li>Alter the dt associated with a given tick, using the
<strong>moose.setClock( tick, newdt)</strong> command</li>
<li>Go through a wildcard path of objects reassigning there clock ticks,
using <strong>moose.useClock( path, newtick, function)</strong>.</li>
</ul>
</div></blockquote>
<p>Here we discuss these in more detail.</p>
<p><strong>Altering the &#8216;tick&#8217; field</strong></p>
<p>Every object knows which tick and dt it uses:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/a&#39;</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">a</span><span class="o">.</span><span class="n">tick</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dt</span>
<span class="go">13 0.1</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">tick</span></code> field on every object can be changed, and the object will
adopt whatever clock dt is used for that tick. The <code class="docutils literal"><span class="pre">dt</span></code> field is
readonly, because changing it would have side-effects on every object
associated with the current tick.</p>
<p>Ticks <strong>-1</strong> and <strong>-2</strong> are special: They both tell the object that it is
disabled (not scheduled for any operations). An object with a
tick of <strong>-1</strong> will be left alone entirely. A tick of <strong>-2</strong> is used in
solvers to indicate that should the solver be removed, the object will
revert to its default tick.</p>
<p><strong>Altering the dt associated with a given tick</strong></p>
<p>We initialize the ticks and set their <code class="docutils literal"><span class="pre">dt</span></code> values using the
<code class="docutils literal"><span class="pre">setClock</span></code> function.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.025e-3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.025e-3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.25e-3</span><span class="p">)</span>
</pre></div>
</div>
<p>This will initialize tick #0 and tick #1 with <code class="docutils literal"><span class="pre">dt</span> <span class="pre">=</span> <span class="pre">25</span></code> Î¼s and tick #2
with <code class="docutils literal"><span class="pre">dt</span> <span class="pre">=</span> <span class="pre">250</span></code> Î¼s. Thus all the elements scheduled on ticks #0 and 1
will be updated every 25 Î¼s and those on tick #2 every 250 Î¼s. We use
the faster clocks for the model components where finer timescale is
required for numerical accuracy and the slower clock to sample the
values of <code class="docutils literal"><span class="pre">Vm</span></code>.</p>
<p>Note that if you alter the dt associated with a given tick, this will
affect the update time for <em>all</em> the objects using that clock tick. If
you&#8217;re unsure that you want to do this, use one of the vacant ticks.</p>
<p><strong>Assigning clock ticks to all objects in a wildcard path</strong></p>
<p>To assign tick #2 to the table for recording <code class="docutils literal"><span class="pre">Vm</span></code>, we pass its
whole path to the <code class="docutils literal"><span class="pre">useClock</span></code> function.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">useClock</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;/data/soma_Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;process&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Read this as &#8220;use tick # 2 on the element at path <code class="docutils literal"><span class="pre">/data/soma_Vm</span></code> to
call its <code class="docutils literal"><span class="pre">process</span></code> method at every step&#8221;. Every class that is supposed
to update its state or take some action during simulation implements a
<code class="docutils literal"><span class="pre">process</span></code> method. And in most cases that is the method we want the
ticks to call at every time step. A less common method is <code class="docutils literal"><span class="pre">init</span></code>,
which is implemented in some classes to interleave actions or updates
that must be executed in a specific order <a class="footnote-reference" href="#id8" id="id4">[4]</a>. The <code class="docutils literal"><span class="pre">Compartment</span></code>
class is one such case where a neuronal compartment has to know the
<code class="docutils literal"><span class="pre">Vm</span></code> of its neighboring compartments before it can calculate its
<code class="docutils literal"><span class="pre">Vm</span></code> for the next step. This is done with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">useClock</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">soma</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;init&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we used the <code class="docutils literal"><span class="pre">path</span></code> field instead of writing the path explicitly.</p>
<p>Next we assign tick #1 to process method of everything under <code class="docutils literal"><span class="pre">/model</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">useClock</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;/model/##&#39;</span><span class="p">,</span> <span class="s1">&#39;process&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here the second argument is an example of wild-card path. The <code class="docutils literal"><span class="pre">##</span></code>
matches everything under the path preceding it at any depth. Thus if we
had some other objects under <code class="docutils literal"><span class="pre">/model/soma</span></code>, <code class="docutils literal"><span class="pre">process</span></code> method of
those would also have been scheduled on tick #1. This is very useful for
complex models where it is tedious to scheduled each element
individually. In this case we could have used <code class="docutils literal"><span class="pre">/model/#</span></code> as well for
the path. This is a single level wild-card which matches only the
children of <code class="docutils literal"><span class="pre">/model</span></code> but does not go farther down in the hierarchy.</p>
</div>
<div class="section" id="running-the-simulation">
<span id="quickstart-running"></span><h2><a class="toc-backref" href="#id16">Running the simulation</a><a class="headerlink" href="#running-the-simulation" title="Permalink to this headline">¶</a></h2>
<p>Once the model is all set up, we can put the model to its
initial state using</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
</pre></div>
</div>
<p>You may remember that we had changed initVm from <code class="docutils literal"><span class="pre">-0.06</span></code> to <code class="docutils literal"><span class="pre">-0.07</span></code>.
The reinit call we initialize <code class="docutils literal"><span class="pre">Vm</span></code> to that value. You can verify that</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">soma</span><span class="o">.</span><span class="n">Vm</span>
<span class="go">-0.07</span>
</pre></div>
</div>
<p>Finally, we run the simulation for 300 ms</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mf">300e-3</span><span class="p">)</span>
</pre></div>
</div>
<p>The data will be recorded by the <code class="docutils literal"><span class="pre">soma_vm</span></code> table, which is referenced
by the variable <code class="docutils literal"><span class="pre">vmtab</span></code>. The <code class="docutils literal"><span class="pre">Table</span></code> class provides a numpy array
interface to its content. The field is <code class="docutils literal"><span class="pre">vector</span></code>. So you can easily plot
the membrane potential using the <a class="reference external" href="http://matplotlib.org/">matplotlib</a>
library.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pylab</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">300e-3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vmtab</span><span class="o">.</span><span class="n">vector</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">vmtab</span><span class="o">.</span><span class="n">vector</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The first line imports the pylab submodule from matplotlib. This useful
for interactive plotting. The second line creates the time points to
match our simulation time and length of the recorded data. The third
line plots the <code class="docutils literal"><span class="pre">Vm</span></code> and the fourth line makes it visible. Does the
plot match your expectation?</p>
</div>
<div class="section" id="some-more-details">
<span id="quickstart-details"></span><h2><a class="toc-backref" href="#id17">Some more details</a><a class="headerlink" href="#some-more-details" title="Permalink to this headline">¶</a></h2>
<div class="section" id="vec-melement-and-element">
<h3><code class="docutils literal"><span class="pre">vec</span></code>, <code class="docutils literal"><span class="pre">melement</span></code> and <code class="docutils literal"><span class="pre">element</span></code><a class="headerlink" href="#vec-melement-and-element" title="Permalink to this headline">¶</a></h3>
<p>MOOSE elements are instances of the class <code class="docutils literal"><span class="pre">melement</span></code>. <code class="docutils literal"><span class="pre">Compartment</span></code>,
<code class="docutils literal"><span class="pre">PulseGen</span></code> and other MOOSE classes are derived classes of
<code class="docutils literal"><span class="pre">melement</span></code>. All <code class="docutils literal"><span class="pre">melement</span></code> instances are contained in array-like
structures called <code class="docutils literal"><span class="pre">vec</span></code>. Each <code class="docutils literal"><span class="pre">vec</span></code> object has a numerical
<code class="docutils literal"><span class="pre">id_</span></code> field uniquely identifying it. An <code class="docutils literal"><span class="pre">vec</span></code> can have one or
more elements. You can create an array of elements</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">comp_array</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">vec</span><span class="p">(</span><span class="s1">&#39;/model/comp&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;Compartment&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This tells MOOSE to create an <code class="docutils literal"><span class="pre">vec</span></code> of 3 <code class="docutils literal"><span class="pre">Compartment</span></code> elements
with path <code class="docutils literal"><span class="pre">/model/comp</span></code>. For <code class="docutils literal"><span class="pre">vec</span></code> objects with multiple
elements, the index in the <code class="docutils literal"><span class="pre">vec</span></code> is part of the element path.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">comp_array</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">comp_array</span><span class="p">)</span>
</pre></div>
</div>
<p>shows that <code class="docutils literal"><span class="pre">comp_array</span></code> is an instance of <code class="docutils literal"><span class="pre">vec</span></code> class. You can
loop through the elements in an <code class="docutils literal"><span class="pre">vec</span></code> like a Python list</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">comp_array</span><span class="p">:</span>
<span class="gp">... </span>   <span class="nb">print</span> <span class="n">comp</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>shows</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">comp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span><span class="nb">type</span> <span class="s1">&#39;moose.melement&#39;</span><span class="o">&gt;</span>
<span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">comp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span><span class="nb">type</span> <span class="s1">&#39;moose.melement&#39;</span><span class="o">&gt;</span>
<span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">comp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span><span class="nb">type</span> <span class="s1">&#39;moose.melement&#39;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Thus elements are instances of class <code class="docutils literal"><span class="pre">melement</span></code>. All elements in an
<code class="docutils literal"><span class="pre">vec</span></code> share the <code class="docutils literal"><span class="pre">id_</span></code> of the <code class="docutils literal"><span class="pre">vec</span></code> which can retrieved by
<code class="docutils literal"><span class="pre">melement.getId()</span></code>.</p>
<p>A frequent use case is that after loading a model from a file one knows
the paths of various model components but does not know the appropriate
class name for them. For this scenario there is a function called
<code class="docutils literal"><span class="pre">element</span></code> which converts (&#8220;casts&#8221; in programming jargon) a path or any
moose object to its proper MOOSE class. You can create additional
references to <code class="docutils literal"><span class="pre">soma</span></code> in the example this way</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span><span class="s1">&#39;/model/soma&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Any MOOSE class can be extended in Python. But any additional attributes
added in Python are invisible to MOOSE. So those can be used for
functionalities at the Python level only. You can see
<code class="docutils literal"><span class="pre">moose-examples/squid/squid.py</span></code> for an example.</p>
</div>
<div class="section" id="finfos">
<h3><code class="docutils literal"><span class="pre">Finfos</span></code><a class="headerlink" href="#finfos" title="Permalink to this headline">¶</a></h3>
<p>The following kinds of <code class="docutils literal"><span class="pre">Finfo</span></code> are accessible in Python</p>
<ul class="simple">
<li><strong>``valueFinfo``</strong> : simple values. For each readable <code class="docutils literal"><span class="pre">valueFinfo</span></code>
<code class="docutils literal"><span class="pre">XYZ</span></code> there is a <code class="docutils literal"><span class="pre">destFinfo</span></code> <code class="docutils literal"><span class="pre">getXYZ</span></code> that can be used for
reading the value at run time. If <code class="docutils literal"><span class="pre">XYZ</span></code> is writable then there will
also be <code class="docutils literal"><span class="pre">destFinfo</span></code> to set it: <code class="docutils literal"><span class="pre">setXYZ</span></code>. Example:
<code class="docutils literal"><span class="pre">Compartment.Rm</span></code></li>
<li><strong>``lookupFinfo``</strong> : lookup tables. These fields act like Python
dictionaries but iteration is not supported. Example:
<code class="docutils literal"><span class="pre">Neutral.neighbors</span></code>.</li>
<li><strong>``srcFinfo``</strong> : source of a message. Example:
<code class="docutils literal"><span class="pre">PulseGen.output</span></code>.</li>
<li><strong>``destFinfo``</strong> : destination of a message. Example:
<code class="docutils literal"><span class="pre">Compartment.injectMsg</span></code>. Apart from being used in setting up
messages, these are accessible as functions from Python.
<code class="docutils literal"><span class="pre">HHGate.setupAlpha</span></code> is an example.</li>
<li><strong>``sharedFinfo``</strong> : a composition of source and destination fields.
Example: <code class="docutils literal"><span class="pre">Compartment.channel</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="moving-on">
<span id="quickstart-moving-on"></span><h2><a class="toc-backref" href="#id18">Moving on</a><a class="headerlink" href="#moving-on" title="Permalink to this headline">¶</a></h2>
<p>Now you know the basics of pymoose and how to access the help
system. You can figure out how to do specific things by looking at the
<span class="xref doc">moose_cookbook</span>.  In addition, the <code class="docutils literal"><span class="pre">moose-examples/snippets</span></code> directory
in your MOOSE installation has small executable python scripts that
show usage of specific classes or functionalities. Beyond that you can
browse the code in the <code class="docutils literal"><span class="pre">moose-examples</span></code> directory to see some more complex
models.</p>
<p>MOOSE is backward compatible with GENESIS and most GENESIS classes have
been reimplemented in MOOSE. There is slight change in naming (MOOSE
uses CamelCase), and setting up messages are different. But <a class="reference external" href="http://www.genesis-sim.org/GENESIS/Hyperdoc/Manual.html">GENESIS
documentation</a>
is still a good source for documentation on classes that have been
ported from GENESIS.</p>
<p>If the built-in MOOSE classes do not satisfy your needs entirely, you
are welcome to add new classes to MOOSE. The API documentation will
help you get started.</p>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>To list the classes only, use <code class="docutils literal"><span class="pre">moose.le('/classes')</span></code></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>MOOSE is unit agnostic and things should work fine as long as you use
values all converted to a consistent unit system.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>This apparently convoluted implementation is for performance reason.
Can you figure out why? <em>Hint: the table is driven by a slower clock
than the compartment.</em></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>In principle any function available in a MOOSE class can be executed
periodically this way as long as that class exposes the function for
scheduling following the MOOSE API. So you have to consult the class&#8217;
documentation for any nonstandard methods that can be scheduled this
way.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="demonstration-of-basic-functionalities">
<h2><a class="toc-backref" href="#id19">Demonstration of basic functionalities</a><a class="headerlink" href="#demonstration-of-basic-functionalities" title="Permalink to this headline">¶</a></h2>
<div class="section" id="module-helloMoose">
<span id="load-and-run-a-model"></span><span id="quickstart-load-run"></span><h3>Load and Run a Model<a class="headerlink" href="#module-helloMoose" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="helloMoose.main">
<code class="descclassname">helloMoose.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#helloMoose.main" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the Hello MOOSE program. It shows how to get MOOSE to do
its most basic operations: to load, run, and graph a model defined
in an external model definition file.</p>
<p>The loadModel function is the core of this example. It can accept
a range of file and model types, including kkit, cspace and GENESIS .p
files. It autodetects the file type and loads in the simulation.</p>
<p>The wildcardFind function finds all objects matching the specified path,
in this case Table objects hoding the simulation results. They were
all defined in the model file.</p>
</dd></dl>

</div>
<div class="section" id="module-startstop">
<span id="start-stop-and-setting-clocks"></span><span id="quickstart-timing"></span><h3>Start, Stop, and setting clocks<a class="headerlink" href="#module-startstop" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="startstop.main">
<code class="descclassname">startstop.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#startstop.main" title="Permalink to this definition">¶</a></dt>
<dd><p>This demo shows how to start, stop, and continue a simulation.
This is commonly done when we want to run a model till settling, then
change a parameter or deliver a stimulus, and then continue the
simulation.</p>
<p>Here, the model is just the output of a PulseGen object which
generates periodic pulses.
The demo shows how to start the simulation. using the
<em>moose.reinit</em> command to reset the model to its initial state,
and <em>moose.start</em> command to run the model for the specified duration.
We issue multiple <em>moose.start</em> commands and do different things to
the model between them. First, we change the delay of the pulseGen.
Then we show a number of ways to assign the timestep (dt) to the
table object in the simulation.
Note that throughout this simulation the pulsegen is going at a
uniform rate, it is just being sampled by the output table at
different intervals.</p>
</dd></dl>

<span class="target" id="module-stimtable"></span><dl class="function">
<dt id="stimtable.main">
<code class="descclassname">stimtable.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#stimtable.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Example of StimulusTable using Poisson random numbers.</p>
<p>Creates a StimulusTable and assigns it signal representing events in a
Poisson process. The output of the StimTable is sent to a DiffAmp
object for buffering and then recorded in a regular table.</p>
</dd></dl>

</div>
<div class="section" id="module-pyrun">
<span id="run-python-from-moose"></span><span id="quickstart-python-from-moose"></span><h3>Run Python from MOOSE<a class="headerlink" href="#module-pyrun" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="pyrun.input_output">
<code class="descclassname">pyrun.</code><code class="descname">input_output</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyrun.input_output" title="Permalink to this definition">¶</a></dt>
<dd><p>The PyRun class can take a double input through <cite>trigger</cite>
field. Whenever another object sends an input to this field, the
<cite>runString</cite> is executed.</p>
<p>The fun part of this is that you can use the input value in your
python statements in <cite>runString</cite>. This is stored in a local
variable called <cite>input_</cite>. You can rename this by setting <cite>inputVar</cite>
field.</p>
<p>Things become even more interesting when you can send out a value
computed using Python. PyRun objects allow you to define a local
variable called <cite>output</cite> and whatever value you assign to this,
will be sent out through the source field <cite>output</cite> on successful
execution of the <cite>runString</cite>.</p>
<p>You can rename the output variable by setting <cite>outputVar</cite> field.</p>
<p>In this example, we send the output of a pulsegen object sending
out the values 1, 2, 3 during each pulse and compute the square of
these numbers in Python and set output to this square.</p>
<p>The calculated value is assigned to the <cite>output</cite> variable and in
turn sent out to a Table object&#8217;s input and gets recorded.</p>
<p>By default PyRun executes the <cite>runString</cite> whenever a <cite>trigger</cite>
message is received and when its process method is called at each
timestep. In both cases it sends out the <cite>output</cite> value. Since
this may cause inaccuracies depending on what the Python
statements in <cite>runString</cite> do, a <cite>mode</cite> can be specified to disable
one of the above. We set <code class="docutils literal"><span class="pre">mode</span> <span class="pre">=</span> <span class="pre">2</span></code> to disable the <cite>process</cite>
method. Note that this could also have been done by setting its
<code class="docutils literal"><span class="pre">tick</span> <span class="pre">=</span> <span class="pre">-1</span></code>.</p>
<p><code class="docutils literal"><span class="pre">mode</span> <span class="pre">=</span> <span class="pre">1</span></code> will disable <cite>trigger</cite> message and <code class="docutils literal"><span class="pre">mode</span> <span class="pre">=</span> <span class="pre">0</span></code>, the
default, enables both.</p>
</dd></dl>

<dl class="function">
<dt id="pyrun.main">
<code class="descclassname">pyrun.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyrun.main" title="Permalink to this definition">¶</a></dt>
<dd><p>You can use the PyRun class to run Python statements from MOOSE at
runtime. This opens up many possibilities of interleaving computing in
Python and MOOSE. You can also use this for debugging simulations.</p>
</dd></dl>

<dl class="function">
<dt id="pyrun.run_sequence">
<code class="descclassname">pyrun.</code><code class="descname">run_sequence</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyrun.run_sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>In this example we demonstrate the use of PyRun objects to execute
Python statements from MOOSE. Here is a couple of fun things to
indicate the power of MOOSE-Python integration.</p>
<p>First we create a PyRun object called <cite>Hello</cite>. In its <cite>initString</cite>
we put in Python statements that prints the element&#8217;s string
representation using pymoose-API. When <code class="docutils literal"><span class="pre">moose.reinit()</span></code> is
called, this causes MOOSE to execute these Python statements which
include Python calling a MOOSE function
(Python-&gt;MOOSE-&gt;Python-&gt;MOOSE) - isn&#8217;t that cool!</p>
<p>We also initialize a counter called <cite>hello_count</cite> to 0.</p>
<p>The statements in initString gets executed once, when we call
<code class="docutils literal"><span class="pre">moose.reinit()</span></code>.</p>
<p>In the <cite>runString</cite> we put a couple of print statements to indicate
the name fof the object which is running and the current
count. Then we increase the count directly.</p>
<p>When we call <code class="docutils literal"><span class="pre">moose.start()</span></code>, the <cite>runString</cite> gets executed at
each time step.</p>
<p>The other PyRun object we create, is <cite>/World</cite>. In its <cite>initString</cite>
apart from ordinary print statements and initialization, we define
a Python function called <code class="docutils literal"><span class="pre">incr_count</span></code>. This silly little
function just increments the global <cite>world_count</cite> by 1.</p>
<p>The <cite>runString</cite> for <cite>World</cite> simply calls this function to
increment the count and print it.</p>
<p>We may notice that we assign tick 0 to <cite>Hello</cite> and tick 1 to
<cite>World</cite>. Looking at the output, you will realize that the
sequences of the ticks strictly maintain the sequence of
execution.</p>
</dd></dl>

<span class="target" id="module-pyrun1"></span><dl class="function">
<dt id="pyrun1.main">
<code class="descclassname">pyrun1.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyrun1.main" title="Permalink to this definition">¶</a></dt>
<dd><p>You can use the PyRun class to run Python statements from MOOSE at
runtime. This opens up many possibilities of interleaving computing in
Python and MOOSE. You can also use this for debugging simulations.</p>
<p>The PyRun class can take a double input through <cite>trigger</cite>
field. Whenever another object sends an input to this field, the
<cite>runString</cite> is executed.</p>
<p>The fun part of this is that you can use the input value in your
python statements in <cite>runString</cite>. This is stored in a local
variable called <cite>input_</cite>. You can rename this by setting <cite>inputVar</cite>
field.</p>
<p>Things become even more interesting when you can send out a value
computed using Python. PyRun objects allow you to define a local
variable called <cite>output</cite> and whatever value you assign to this,
will be sent out through the source field <cite>output</cite> on successful
execution of the <cite>runString</cite>.</p>
<p>You can rename the output variable by setting <cite>outputVar</cite> field.</p>
<p>In this example, we send the output of a pulsegen object sending
out the values 1, 2, 3 during each pulse and compute the square of
these numbers in Python and set output to this square.</p>
<p>The calculated value is assigned to the <cite>output</cite> variable and in
turn sent out to a Table object&#8217;s input and gets recorded.</p>
<p>By default PyRun executes the <cite>runString</cite> whenever a <cite>trigger</cite>
message is received and when its process method is called at each
timestep. In both cases it sends out the <cite>output</cite> value. Since
this may cause inaccuracies depending on what the Python
statements in <cite>runString</cite> do, a <cite>mode</cite> can be specified to disable
one of the above. We set <code class="docutils literal"><span class="pre">mode</span> <span class="pre">=</span> <span class="pre">2</span></code> to disable the <cite>process</cite>
method. Note that this could also have been done by setting its
<code class="docutils literal"><span class="pre">tick</span> <span class="pre">=</span> <span class="pre">-1</span></code>.</p>
<p><code class="docutils literal"><span class="pre">mode</span> <span class="pre">=</span> <span class="pre">1</span></code> will disable <cite>trigger</cite> message and <code class="docutils literal"><span class="pre">mode</span> <span class="pre">=</span> <span class="pre">0</span></code>, the
default, enables both.</p>
</dd></dl>

<dl class="function">
<dt id="pyrun1.run_sequence">
<code class="descclassname">pyrun1.</code><code class="descname">run_sequence</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyrun1.run_sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>In this example we demonstrate the use of PyRun objects to execute
Python statements from MOOSE. Here is a couple of fun things to
indicate the power of MOOSE-Python integration.</p>
<p>First we create a PyRun object called <cite>Hello</cite>. In its <cite>initString</cite>
we put in Python statements that prints the element&#8217;s string
representation using pymoose-API. When <code class="docutils literal"><span class="pre">moose.reinit()</span></code> is
called, this causes MOOSE to execute these Python statements which
include Python calling a MOOSE function
(Python-&gt;MOOSE-&gt;Python-&gt;MOOSE) - isn&#8217;t that cool!</p>
<p>We also initialize a counter called <cite>hello_count</cite> to 0.</p>
<p>The statements in initString gets executed once, when we call
<code class="docutils literal"><span class="pre">moose.reinit()</span></code>.</p>
<p>In the <cite>runString</cite> we put a couple of print statements to indicate
the name fof the object which is running and the current
count. Then we increase the count directly.</p>
<p>When we call <code class="docutils literal"><span class="pre">moose.start()</span></code>, the <cite>runString</cite> gets executed at
each time step.</p>
<p>The other PyRun object we create, is <cite>/World</cite>. In its <cite>initString</cite>
apart from ordinary print statements and initialization, we define
a Python function called <code class="docutils literal"><span class="pre">incr_count</span></code>. This silly little
function just increments the global <cite>world_count</cite> by 1.</p>
<p>The <cite>runString</cite> for <cite>World</cite> simply calls this function to
increment the count and print it.</p>
<p>We may notice that we assign tick 0 to <cite>Hello</cite> and tick 1 to
<cite>World</cite>. Looking at the output, you will realize that the
sequences of the ticks strictly maintain the sequence of
execution.</p>
</dd></dl>

</div>
<div class="section" id="moose-classes">
<span id="quickstart-classes"></span><h3>MOOSE Classes<a class="headerlink" href="#moose-classes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="messages">
<h4>Messages<a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h4>
<div class="section" id="module-onetoonemsg">
<span id="one-to-one-message"></span><h5>One-to-one message<a class="headerlink" href="#module-onetoonemsg" title="Permalink to this headline">¶</a></h5>
<dl class="function">
<dt id="onetoonemsg.main">
<code class="descclassname">onetoonemsg.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#onetoonemsg.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Demonstrates one-to-one connection between objects through &#8216;&#8217;moose.connect&#8217;&#8216;.</p>
</dd></dl>

</div>
<div class="section" id="module-showmsg">
<span id="show-the-message"></span><h5>Show the message<a class="headerlink" href="#module-showmsg" title="Permalink to this headline">¶</a></h5>
<dl class="function">
<dt id="showmsg.main">
<code class="descclassname">showmsg.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#showmsg.main" title="Permalink to this definition">¶</a></dt>
<dd><p>This is to show a _raw_ way of traversing messages.</p>
</dd></dl>

</div>
<div class="section" id="module-singlemsgcross">
<span id="single-message-cross"></span><h5>Single Message Cross<a class="headerlink" href="#module-singlemsgcross" title="Permalink to this headline">¶</a></h5>
<dl class="function">
<dt id="singlemsgcross.main">
<code class="descclassname">singlemsgcross.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#singlemsgcross.main" title="Permalink to this definition">¶</a></dt>
<dd><p>This example shows that you can have two ematrix objects and
connect individual elements using <cite>Single</cite> message</p>
</dd></dl>

<dl class="function">
<dt id="singlemsgcross.test_crossing_single">
<code class="descclassname">singlemsgcross.</code><code class="descname">test_crossing_single</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#singlemsgcross.test_crossing_single" title="Permalink to this definition">¶</a></dt>
<dd><p>This function creates an ematrix of two PulseGen elements and
another ematrix of two Table elements.</p>
<p>The two pulsegen elements have same amplitude but opposite phase.</p>
<p>Table[0] is connected to PulseGen[1] and Table[1] to Pulsegen[0].</p>
<p>In the plot you should see two square pulses of opposite phase.</p>
</dd></dl>

</div>
</div>
<div class="section" id="time">
<h4>Time<a class="headerlink" href="#time" title="Permalink to this headline">¶</a></h4>
<div class="section" id="module-showclocks">
<span id="clocks"></span><h5>Clocks<a class="headerlink" href="#module-showclocks" title="Permalink to this headline">¶</a></h5>
<dl class="function">
<dt id="showclocks.main">
<code class="descclassname">showclocks.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#showclocks.main" title="Permalink to this definition">¶</a></dt>
<dd><p>This snippet shows various ways of displaying scheduling
information of moose model components.</p>
<p>The <cite>/clock/tick</cite> ematrix has 10 elements, any of which can be setup
by using the <cite>moose.setClock(tickNo, dt)</cite> function. This sets the
interval between the ticking events for it to <cite>dt</cite> time.</p>
<p>Individual model components can be assigned ticks by
<cite>moose.useClock(tickNo, targetPath, targetFinfo)</cite>. Commonly used
target finfo is <cite>process</cite>, which causes the function of the same name
in the ematrix at target path to be called at each ticking event of
tick <cite>tickNo</cite>. Thus displaying the neighbors of <cite>process</cite> finfo of an
element will show the tick assigned to it.</p>
<p>On the other hand, the tick ematrix has 10 finfos, <cite>proc0</cite> ... <cite>proc9</cite>
which connect to all the targets of the corresponding <cite>tickNo</cite>. You
can display the neighbors of these finfos also to see what is
scheduled on each tick.</p>
</dd></dl>

</div>
<div class="section" id="module-timetable">
<span id="generating-time-data-table"></span><h5>Generating Time Data Table<a class="headerlink" href="#module-timetable" title="Permalink to this headline">¶</a></h5>
<dl class="function">
<dt id="timetable.generate_poisson_times">
<code class="descclassname">timetable.</code><code class="descname">generate_poisson_times</code><span class="sig-paren">(</span><em>rate=20</em>, <em>simtime=100</em>, <em>seed=1</em><span class="sig-paren">)</span><a class="headerlink" href="#timetable.generate_poisson_times" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate Poisson spike times using <cite>rate</cite>. Use <cite>seed</cite> for seeding
the numpy rng</p>
</dd></dl>

<dl class="function">
<dt id="timetable.main">
<code class="descclassname">timetable.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#timetable.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Demonstrates the use of TimeTable elements in MOOSE.</p>
<p>This scripts creates two time tables, #1 is filled with entries in a
numpy array and #2 is filled from a text file containing the event
times.</p>
<p>The <cite>state</cite> field of #1, which becomes 1 when an event occurs and 0
otherwise, is recorded.</p>
<p>On the other hand, #2 is connected to a synapse (in a SynChan element)
to demonstrate artificial spike event generation.</p>
</dd></dl>

<dl class="function">
<dt id="timetable.timetable_file">
<code class="descclassname">timetable.</code><code class="descname">timetable_file</code><span class="sig-paren">(</span><em>filename='timetable.txt'</em><span class="sig-paren">)</span><a class="headerlink" href="#timetable.timetable_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a TimeTable and populate it from file specified by
<cite>filename</cite>. If <cite>filename</cite> does not exist, a file of the same name is
created and a random series of spike times is saved in it</p>
</dd></dl>

<dl class="function">
<dt id="timetable.timetable_nparray">
<code class="descclassname">timetable.</code><code class="descname">timetable_nparray</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#timetable.timetable_nparray" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a time table and populate it with numpy array. The <cite>vec</cite>
field in a Table can be directly assigned a sequence to fill the
table entries.</p>
</dd></dl>

</div>
</div>
<div class="section" id="module-vectors">
<span id="vectors"></span><h4>Vectors<a class="headerlink" href="#module-vectors" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="vectors.main">
<code class="descclassname">vectors.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#vectors.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Demonstrates how to use vectors of moose elements</p>
</dd></dl>

</div>
<div class="section" id="module-wildcard">
<span id="data-entries"></span><h4>Data Entries<a class="headerlink" href="#module-wildcard" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="wildcard.main">
<code class="descclassname">wildcard.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wildcard.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Explore the wildcard search in moose models</p>
</dd></dl>

</div>
<div class="section" id="interpolation">
<h4>Interpolation<a class="headerlink" href="#interpolation" title="Permalink to this headline">¶</a></h4>
<div class="section" id="module-interpol">
<span id="dimentional-interpolation"></span><h5>1-dimentional Interpolation<a class="headerlink" href="#module-interpol" title="Permalink to this headline">¶</a></h5>
<dl class="function">
<dt id="interpol.main">
<code class="descclassname">interpol.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#interpol.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Example of Interpol object.</p>
</dd></dl>

</div>
<div class="section" id="module-interpol2d">
<span id="id9"></span><h5>2-dimentional interpolation<a class="headerlink" href="#module-interpol2d" title="Permalink to this headline">¶</a></h5>
<p>Example of Interpol object in 2 dimensions.</p>
</div>
</div>
<div class="section" id="module-func">
<span id="function"></span><h4>Function<a class="headerlink" href="#module-func" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="func.main">
<code class="descclassname">func.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#func.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Demonstrate the use of Func class</p>
</dd></dl>

<dl class="function">
<dt id="func.test_func">
<code class="descclassname">func.</code><code class="descname">test_func</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#func.test_func" title="Permalink to this definition">¶</a></dt>
<dd><p>This function creates a Func object evaluating a function of a
single variable. It both shows direct evaluation without running a
simulation and a case where the x variable comes from another
source.</p>
</dd></dl>

<dl class="function">
<dt id="func.test_func_nosim">
<code class="descclassname">func.</code><code class="descname">test_func_nosim</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#func.test_func_nosim" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a Func object for computing function values without running
a simulations.</p>
</dd></dl>

</div>
<div class="section" id="module-symcompartment">
<span id="symcompartment"></span><h4>SymCompartment<a class="headerlink" href="#module-symcompartment" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="symcompartment.main">
<code class="descclassname">symcompartment.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#symcompartment.main" title="Permalink to this definition">¶</a></dt>
<dd><p>This example demonstrats the use of SymCompartment class of MOOSE.</p>
</dd></dl>

</div>
<div class="section" id="module-tabledemo">
<span id="tables"></span><h4>Tables<a class="headerlink" href="#module-tabledemo" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="tabledemo.main">
<code class="descclassname">tabledemo.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#tabledemo.main" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="xref py py-class docutils literal"><span class="pre">Table</span></code> can be used for recording and saving data in ascii text formats.
In this example we create a square-pulse generator object and
record the output using a table.</p>
<p>The steps are:</p>
<ol class="arabic simple">
<li>Create a PulseGen element <cite>pulse</cite>.</li>
<li>Set <cite>delay[0]=1.0</cite>, <cite>width[0]=0.2</cite>, <cite>level[0]=0.5</cite>, so it
generates 0.2 s wide square pulses with 0.5 amplitude every 1 s.</li>
<li>Create a Table element <cite>tab</cite>.</li>
<li>Connect the <cite>outputValue</cite> field of <cite>pulse</cite> to <cite>tab</cite>.</li>
<li>We set tick-interval of ticks 0 and 1 to 0.01 and schedule
<cite>pulse</cite> on tick 0 and <cite>tab</cite> on tick 1.</li>
</ol>
<ol class="arabic simple" start="5">
<li>Run the simulation for 5 s and save data to the ascii file
<cite>output_tabledemo.csv</cite>.</li>
</ol>
</dd></dl>

</div>
<div class="section" id="data-types">
<h4>Data Types<a class="headerlink" href="#data-types" title="Permalink to this headline">¶</a></h4>
<div class="section" id="module-hdfdemo">
<span id="hdf-datatype"></span><h5>HDF DataType<a class="headerlink" href="#module-hdfdemo" title="Permalink to this headline">¶</a></h5>
<p>HDF5 is a self-describing file format for storing large
datasets. MOOSE has an utility <code class="xref py py-class docutils literal"><span class="pre">HDF5DataWriter</span></code> for saving
simulations data in HDF5 files.</p>
<dl class="function">
<dt id="hdfdemo.main">
<code class="descclassname">hdfdemo.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#hdfdemo.main" title="Permalink to this definition">¶</a></dt>
<dd><p>In this example</p>
<ol class="arabic simple">
<li>We create a passive neuronal compartment <cite>comp</cite>.</li>
<li>We create an HDF5DataWriter object <cite>hdfwriter</cite> for writing to a
file <code class="docutils literal"><span class="pre">output_hdfdemo.h5</span></code>.  The <cite>mode</cite> of the HDF5DataWriter
is set to <cite>2</cite> which means if a file of the same name exists, it
will be overwritten.</li>
<li>The membrane voltage <cite>Vm</cite> and membrane current <cite>Im</cite> of <cite>comp</cite>
are connected to <cite>hdfwriter</cite> for recording.</li>
<li>We set some attributes of the datasets and the file.</li>
<li>We run the simulation, <cite>hdfwriter</cite> records and stores the <cite>Vm</cite>
and <cite>Im</cite> values over time.</li>
<li>We close the file by calling close() method of <cite>hdfwriter</cite>.</li>
</ol>
<p>Running this snippet creates the file <code class="docutils literal"><span class="pre">output_hdfdemo.h5</span></code> which
reflects the structure of the model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">model</span>
  <span class="o">|</span>
  <span class="o">|</span>
  <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span>
  <span class="o">|</span><span class="n">___im</span>
  <span class="o">|</span>
  <span class="o">|</span><span class="n">___vm</span>
</pre></div>
</div>
<p><cite>im</cite> and <cite>vm</cite> are datasets containing <cite>Im</cite> and <cite>Vm</cite> field values
recorded from <cite>comp</cite>.</p>
</dd></dl>

</div>
<div class="section" id="module-nsdf">
<span id="nsdf-datatype"></span><h5>NSDF DataType<a class="headerlink" href="#module-nsdf" title="Permalink to this headline">¶</a></h5>
<p>NSDF : Neuroscience Simulation Data Format</p>
<p>NSDF is an HDF5 based format for storing data from neuroscience
simulation.</p>
<p>This script is for demonstrating the use of NSDFWriter class to
dump data in NSDF format.</p>
<p>The present implementation of NSDFWriter puts all value fields
connected to its requestData into
/data/uniform/{className}/{fieldName} 2D dataset - each row
corresponding to one object.</p>
<p>Event data are stored in
/data/event/{className}/{fieldName}/{Id}_{dataIndex}_{fieldIndex}
where the last component is the string representation of the ObjId of
the source.</p>
<p>The model tree (starting below root element) is saved as a tree of
groups under /model/modeltree (one could easily add the fields as
atributes with a little bit of more code).</p>
<p>The mapping between data source and uniformly sampled data is stored
as a dimension scale in /map/uniform/{className}/{fieldName}. That for
event data is stored as a compound dataset in
/map/event/{className}/{fieldName} with a [source, data] columns.</p>
<p>The start and end timestamps of the simulation are saved as file
attributes: C/C++ time functions have this limitation that they give
resolution up to a second, this means for simulation lasting &lt; 1 s the
two timestamps may be identical.</p>
<p>Much of the environment specification is set as HDF5 attributes (which
is a generic feature from HDF5WriterBase).</p>
<p>MOOSE is unit agnostic at present so unit specification is not
implemented in NSDFWriter. But units can be easily added as dataset
attribute if desired as shown in this example.</p>
<p>References:</p>
<p>Ray, Chintaluri, Bhalla and Wojcik. NSDF: Neuroscience Simulation Data
Format, Neuroinformatics, 2015.</p>
<p><a class="reference external" href="http://nsdf.readthedocs.org/en/latest/">http://nsdf.readthedocs.org/en/latest/</a></p>
<dl class="function">
<dt id="nsdf.setup_model">
<code class="descclassname">nsdf.</code><code class="descname">setup_model</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nsdf.setup_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup a dummy model with a PulseGen and a SpikeGen. The SpikeGen
detects the leading edges of the pulses created by the PulseGen
and sends out the event times. We record the PulseGen outputValue
as Uniform data and leading edge time as Event data in the NSDF
file.</p>
</dd></dl>

<span class="target" id="module-nsdf_vec"></span><dl class="function">
<dt id="nsdf_vec.main">
<code class="descclassname">nsdf_vec.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nsdf_vec.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Example code to dump data from multiple elements in a vector.</p>
<p>In this demo we create a PulseGen vector where each element has a
different set of pulse parameters. After saving the output vector
directly using MOOSE NSDFWriter we open the NSDF file using h5py and
plot the saved data.</p>
<p>You need h5py module installed to run this simulation.</p>
<p>References:</p>
<p>Ray, Chintaluri, Bhalla and Wojcik. NSDF: Neuroscience Simulation Data
Format, Neuroinformatics, 2015.</p>
<p><a class="reference external" href="http://nsdf.readthedocs.org/en/latest/">http://nsdf.readthedocs.org/en/latest/</a></p>
</dd></dl>

<dl class="function">
<dt id="nsdf_vec.read_nsdf">
<code class="descclassname">nsdf_vec.</code><code class="descname">read_nsdf</code><span class="sig-paren">(</span><em>fname</em><span class="sig-paren">)</span><a class="headerlink" href="#nsdf_vec.read_nsdf" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the specific file we created in this example.</p>
<p>Note that the preferable way of associating source with data is to
use the DimensionScale. But since there is one-to-one
correspondence between the data rows and the map rows (source
path), we are exploiting that here.</p>
</dd></dl>

<dl class="function">
<dt id="nsdf_vec.write_nsdf">
<code class="descclassname">nsdf_vec.</code><code class="descname">write_nsdf</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nsdf_vec.write_nsdf" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup a dummy model with a PulseGen vec and dump the outputValue in
NSDF file</p>
</dd></dl>

</div>
</div>
<div class="section" id="module-threading_demo">
<span id="threading"></span><h4>Threading<a class="headerlink" href="#module-threading_demo" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="threading_demo.StatusThread">
<em class="property">class </em><code class="descclassname">threading_demo.</code><code class="descname">StatusThread</code><span class="sig-paren">(</span><em>tab</em><span class="sig-paren">)</span><a class="headerlink" href="#threading_demo.StatusThread" title="Permalink to this definition">¶</a></dt>
<dd><p>This thread checks the status of the moose worker thread by
checking the worker_queue for available entry. If there is
nothing, it goes to sleep for a second and then prints current
length of the table. If there is an entry, it puts its name in the
status queue, which is used by the main thread to recognize
successful completion.</p>
</dd></dl>

<dl class="class">
<dt id="threading_demo.WorkerThread">
<em class="property">class </em><code class="descclassname">threading_demo.</code><code class="descname">WorkerThread</code><span class="sig-paren">(</span><em>runtime</em><span class="sig-paren">)</span><a class="headerlink" href="#threading_demo.WorkerThread" title="Permalink to this definition">¶</a></dt>
<dd><p>This thread initializes the simulation (reinit) and then runs
the simulation in its run method. It keeps querying moose for
running status every second and returns when the simulation is
over. It puts its name in the global worker_queue at the end to
signal successful completion.</p>
</dd></dl>

<dl class="function">
<dt id="threading_demo.main">
<code class="descclassname">threading_demo.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#threading_demo.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Example of using multithreading to run a MOOSE simulation in
parallel with querying MOOSE objects involved. See the documentatin
of the classes to get an idea of this demo&#8217;s function.</p>
</dd></dl>

</div>
<div class="section" id="module-traub_naf">
<span id="pymoose"></span><h4>PyMoose<a class="headerlink" href="#module-traub_naf" title="Permalink to this headline">¶</a></h4>
<p>Author: Subhasis Ray</p>
<dl class="function">
<dt id="traub_naf.create_compartment">
<code class="descclassname">traub_naf.</code><code class="descname">create_compartment</code><span class="sig-paren">(</span><em>parent_path</em>, <em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#traub_naf.create_compartment" title="Permalink to this definition">¶</a></dt>
<dd><p>This shows how to use the prototype channel on a compartment.</p>
</dd></dl>

<dl class="function">
<dt id="traub_naf.create_naf_proto">
<code class="descclassname">traub_naf.</code><code class="descname">create_naf_proto</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#traub_naf.create_naf_proto" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an NaF channel prototype in /library. You can copy it later
into any compartment or load a .p file with this channel using
loadModel.</p>
<p>This channel has the conductance form:</p>
<p>Gk(v) = Gbar * m^3 * h (V - Ek)</p>
<p>We are using all SI units</p>
</dd></dl>

<dl class="function">
<dt id="traub_naf.do_iclamp">
<code class="descclassname">traub_naf.</code><code class="descname">do_iclamp</code><span class="sig-paren">(</span><em>vclamp</em>, <em>iclamp</em>, <em>pid</em><span class="sig-paren">)</span><a class="headerlink" href="#traub_naf.do_iclamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Turn on current clamp and turn off voltage clamp</p>
</dd></dl>

<dl class="function">
<dt id="traub_naf.do_vclamp">
<code class="descclassname">traub_naf.</code><code class="descname">do_vclamp</code><span class="sig-paren">(</span><em>vclamp</em>, <em>iclamp</em>, <em>pid</em><span class="sig-paren">)</span><a class="headerlink" href="#traub_naf.do_vclamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Turn on voltage clamp and turn off current clamp</p>
</dd></dl>

<dl class="function">
<dt id="traub_naf.main">
<code class="descclassname">traub_naf.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#traub_naf.main" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an example showing pymoose implementation of the NaF
channel in Traub et al 2005</p>
</dd></dl>

<dl class="function">
<dt id="traub_naf.run_clamp">
<code class="descclassname">traub_naf.</code><code class="descname">run_clamp</code><span class="sig-paren">(</span><em>model_dict</em>, <em>clamp</em>, <em>levels</em>, <em>holding=0.0</em>, <em>simtime=0.1</em><span class="sig-paren">)</span><a class="headerlink" href="#traub_naf.run_clamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Run either voltage or current clamp for default timing settings
with multiple levels of command input.</p>
<p>model_dict: dictionary containing the model components -</p>
<blockquote>
<div><p><cite>vlcamp</cite> - the voltage clamp amplifier</p>
<p><cite>iclamp</cite> - the current clamp amplifier</p>
<p><cite>model</cite> - the model container</p>
<p><cite>data</cite> - the data container</p>
<p><cite>inject_tab</cite> - table recording membrane</p>
<p><cite>command_tab</cite> - table recording command input for voltage or current clamp</p>
<p><cite>vm_tab</cite> - table recording membrane potential</p>
</div></blockquote>
<p>clamp: string specifying clamp mode, either <cite>voltage</cite> or <cite>current</cite></p>
<dl class="docutils">
<dt>levels: sequence of values for command input levels to be</dt>
<dd>simulated.</dd>
</dl>
<p>holding: holding current or voltage</p>
<p>Returns:
a dict containing the following lists of time series:</p>
<p><cite>command</cite> - list of  command input time series
<cite>inject</cite> - list of of membrane current (includes injected current) time series
<cite>vm</cite> - list of membrane voltage time series
<cite>t</cite> - list of time points for all of the above</p>
</dd></dl>

<dl class="function">
<dt id="traub_naf.run_sim">
<code class="descclassname">traub_naf.</code><code class="descname">run_sim</code><span class="sig-paren">(</span><em>model</em>, <em>data</em>, <em>simtime=0.1</em>, <em>simdt=1e-06</em>, <em>plotdt=0.0001</em>, <em>solver='ee'</em><span class="sig-paren">)</span><a class="headerlink" href="#traub_naf.run_sim" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset and run the simulation.</p>
<p>model: model container element</p>
<p>data: data container element</p>
<p>simtime: simulation run time</p>
<p>simdt: simulation timestep</p>
<p>plotdt: plotting time step</p>
<p>solver: neuronal solver to use.</p>
</dd></dl>

<dl class="function">
<dt id="traub_naf.setup_electronics">
<code class="descclassname">traub_naf.</code><code class="descname">setup_electronics</code><span class="sig-paren">(</span><em>model_container</em>, <em>data_container</em>, <em>compartment</em><span class="sig-paren">)</span><a class="headerlink" href="#traub_naf.setup_electronics" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup voltage and current clamp circuit using DiffAmp and PID and
RC filter</p>
</dd></dl>

<dl class="function">
<dt id="traub_naf.setup_model">
<code class="descclassname">traub_naf.</code><code class="descname">setup_model</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#traub_naf.setup_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup the model and the electronic circuit. Also creates the data
container.</p>
</dd></dl>

</div>
<div class="section" id="mathematics-with-moose">
<span id="quickstart-maths"></span><h4>Mathematics with MOOSE<a class="headerlink" href="#mathematics-with-moose" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="module-function">
<span id="computing-an-arbitrary-function"></span><h4>Computing an arbitrary function<a class="headerlink" href="#module-function" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="function.main">
<code class="descclassname">function.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#function.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Function objects can be used to evaluate expressions with arbitrary
number of variables and constants. We can assign expression of the
form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">cM</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">xN</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span><span class="o">...</span><span class="p">,</span> <span class="n">yP</span> <span class="p">)</span>
</pre></div>
</div>
<p>where <cite>ci</cite>&#8216;s are constants and <cite>xi</cite>&#8216;s and <cite>yi</cite>&#8216;s are variables.</p>
<p>The constants must be defined before setting the expression and
variables are connected via messages. The constants can have any
name, but the variable names must be of the form x{i} or y{i}
where i is increasing integer starting from 0.</p>
<p>The <cite>xi</cite>&#8216;s are field elements and you have to set their number
first (function.x.num = N). Then you can connect any source field
sending out double to the &#8216;input&#8217; destination field of the
<cite>x[i]</cite>.</p>
<p>The <cite>yi</cite>&#8216;s are useful when the required variable is a value field
and is not available as a source field. In that case you connect
the <cite>requestOut</cite> source field of the function element to the
<cite>get{Field}</cite> destination field on the target element. The <cite>yi</cite>&#8216;s
are automatically added on connecting. Thus, if you call:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;getSomeField&#39;</span><span class="p">)</span>
<span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;getSomeField&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>then <code class="docutils literal"><span class="pre">a.someField</span></code> will be assigned to <code class="docutils literal"><span class="pre">y0</span></code> and
<code class="docutils literal"><span class="pre">b.someField</span></code> will be assigned to <code class="docutils literal"><span class="pre">y1</span></code>.</p>
<p>In this example we evaluate the expression: <code class="docutils literal"><span class="pre">z</span> <span class="pre">=</span> <span class="pre">c0</span> <span class="pre">*</span> <span class="pre">exp(c1</span> <span class="pre">*</span>
<span class="pre">x0)</span> <span class="pre">*</span> <span class="pre">cos(y0)</span></code></p>
<p>with x0 ranging from -1 to +1 and y0 ranging from -pi to
+pi. These values are stored in two stimulus tables called xtab
and ytab respectively, so that at each timestep the next values of
x0 and y0 are assigned to the function.</p>
<p>Along with the value of the expression itself we also compute its
derivative with respect to y0 and its derivative with respect to
time (rate). The former uses a five-point stencil for the
numerical differentiation and has a glitch at y=0. The latter uses
backward difference divided by dt.</p>
<p>Unlike Func class, the number of variables and constants are
unlimited in Function and you can set all the variables via
messages.</p>
</dd></dl>

</div>
<div class="section" id="module-diffEqSolution">
<span id="differential-equation-solving"></span><h4>Differential Equation Solving<a class="headerlink" href="#module-diffEqSolution" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="diffEqSolution.main">
<code class="descclassname">diffEqSolution.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#diffEqSolution.main" title="Permalink to this definition">¶</a></dt>
<dd><p>This snippet illustrates the solution of an arbitrary set of
differential equations using the <strong>Func</strong> class and the <strong>Pool</strong>
class. The equations solved here are:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tauI</span><span class="o">.</span><span class="n">m</span><span class="s1">&#39; = Ca - Ca_tgt</span>
<span class="n">tauG</span><span class="o">.</span><span class="n">chan</span><span class="s1">&#39; = m - chan</span>
</pre></div>
</div>
<p>These equations are taken from: O&#8217;Leary et al <em>Neuron</em> 2014.</p>
<p><strong>Func</strong> evaluates an arbitrary function each timestep.
Here this function is the rate of change from the equations above.
The rate of change is passed to the <em>increment</em> message of the
<strong>Pool</strong>. The numerical integration method is the Exponential
Euler method but this will work fine if the rates are slow compared to
the simulation timestep.</p>
<p>Conceptually, the idea is that if Ca is greater than the target level,
then more mRNA is made, which makes more channels.
Although the equations have no upper or lower bounds on <strong>m</strong> or
<strong>chan</strong>, MOOSE is sensible about preventing the molecular pools from
having negative concentrations. This does mean that the solution method
employed here won&#8217;t work for the general solution of differential
equations in non-chemical systems.</p>
</dd></dl>

</div>
<div class="section" id="module-funcRateHarmonicOsc">
<span id="harmonic-oscillatory-function"></span><h4>Harmonic Oscillatory Function<a class="headerlink" href="#module-funcRateHarmonicOsc" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="funcRateHarmonicOsc.main">
<code class="descclassname">funcRateHarmonicOsc.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#funcRateHarmonicOsc.main" title="Permalink to this definition">¶</a></dt>
<dd><p>funcRateHarmonicOsc illustrates the use of function objects to
directly define the rates of change of pool concentration. This
example shows how to set up a simple harmonic oscillator system
of differential equations using the script. In normal use one would
prefer to use SBML.</p>
<p>The equations are</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">p</span><span class="s1">&#39; = v - offset1</span>
<span class="n">v</span><span class="s1">&#39; = -k(p - offset2)</span>
</pre></div>
</div>
<p>where the rates for Pools p and v are computed using Functions.
Note the use of offsets. This is because MOOSE chemical
systems cannot have negative concentrations.</p>
<p>The model is set up to run using default Exponential Euler
integration, and then using the GSL deterministic solver.</p>
</dd></dl>

</div>
<div class="section" id="module-funcReacLotkaVolterra">
<span id="lotka-voltera-model"></span><h4>Lotka-Voltera Model<a class="headerlink" href="#module-funcReacLotkaVolterra" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="funcReacLotkaVolterra.main">
<code class="descclassname">funcReacLotkaVolterra.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#funcReacLotkaVolterra.main" title="Permalink to this definition">¶</a></dt>
<dd><p>The funcReacLotkaVolterra example shows how to use function objects
as part of differential equation systems in the framework of the MOOSE
kinetic solvers. Here the system is set up explicitly using the
scripting, in normal use one would expect to use SBML.</p>
<p>In this example we set up a Lotka-Volterra system. The equations
are readily expressed as a pair of reactions each of whose rate is
governed by a function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span><span class="s1">&#39; = x( alpha - beta.y )</span>
<span class="n">y</span><span class="s1">&#39; = -y( gamma - delta.x )</span>
</pre></div>
</div>
<p>This translates into two reactions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">---&gt;</span> <span class="n">z</span>        <span class="n">Kf</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">alpha</span>
<span class="n">y</span> <span class="o">---&gt;</span> <span class="n">z</span>        <span class="n">Kf</span> <span class="o">=</span> <span class="n">gamma</span> <span class="o">-</span> <span class="n">delta</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
<p>Here z is a dummy molecule whose concentration is buffered to zero.</p>
<p>The model first runs using default Exponential Euler integration.
This is not particularly accurate even with a small timestep.
The model is then converted to use the deterministic Kinetic solver
Ksolve. This is accurate and faster.
Note that we cannot use the stochastic GSSA solver for this system, it
cannot handle a reaction term whose rate keeps changing.</p>
</dd></dl>

<span class="target" id="module-stochasticLotkaVolterra"></span><dl class="function">
<dt id="stochasticLotkaVolterra.main">
<code class="descclassname">stochasticLotkaVolterra.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#stochasticLotkaVolterra.main" title="Permalink to this definition">¶</a></dt>
<dd><p>The stochasticLotkaVolterra example is almost identical to the
funcReacLotkaVolterra. It shows how to use function objects
as part of differential equation systems in the framework of the MOOSE
kinetic solvers. Here the difference is that we use a a stochastic
solver. The system is interesting because it illustrates the
instability of Lotka-Volterra systems in stochastic conditions. Here we
see exctinction of one of the species and runaway buildup of the other.
The simulation has to be halted at this point.</p>
<p>Here the system is set up explicitly using the
scripting, in normal use one would expect to use SBML.</p>
<p>In this example we set up a Lotka-Volterra system. The equations
are readily expressed as a pair of reactions each of whose rate is
governed by a function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span><span class="s1">&#39; = x( alpha - beta.y )</span>
<span class="n">y</span><span class="s1">&#39; = -y( gamma - delta.x )</span>
</pre></div>
</div>
<p>This translates into two reactions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">---&gt;</span> <span class="n">z</span>        <span class="n">Kf</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">alpha</span>
<span class="n">y</span> <span class="o">---&gt;</span> <span class="n">z</span>        <span class="n">Kf</span> <span class="o">=</span> <span class="n">gamma</span> <span class="o">-</span> <span class="n">delta</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
<p>Here z is a dummy molecule whose concentration is buffered to zero.</p>
<p>The model first runs using default Exponential Euler integration.
This is not particularly accurate even with a small timestep.
The model is then converted to use the deterministic Kinetic solver
Ksolve. This is accurate and faster.</p>
<p>Note that we cannot use the stochastic GSSA solver for this system, it
cannot handle a reaction term whose rate keeps changing.</p>
</dd></dl>

</div>
<div class="section" id="module-funcInputToPools">
<span id="vary-concentration-with-mathematical-function"></span><h4>Vary Concentration with mathematical function<a class="headerlink" href="#module-funcInputToPools" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="funcInputToPools.main">
<code class="descclassname">funcInputToPools.</code><code class="descname">main</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#funcInputToPools.main" title="Permalink to this definition">¶</a></dt>
<dd><p>This example describes the special (and discouraged) use case where
functions provide input to a reaction system. Here we have two functions of
time which control the pool # and pool rate of change, respectively:</p>
<p>number of molecules of a = 1 + sin(t)
rate of change of number of molecules of b = 10 * cos(t)</p>
<p>In the stochastic case one must set a special flag <em>useClockedUpdate</em>
in order to achieve clock-triggered updates from the functions. This is
needed because the functions do not have reaction events to trigger them,
and even if there were reaction events they might not be frequent enough to
track the periodic updates. The use of this flag slows down the calculations,
so try to use a table to control a pool instead.</p>
<p>To run in stochastic mode:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s1">&#39;&#39;</span><span class="n">python</span> <span class="n">funcInputToPools</span><span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>To run in deterministic mode:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s1">&#39;&#39;</span><span class="n">python</span> <span class="n">funcInputToPools</span> <span class="n">false</span><span class="s1">&#39;&#39;</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../cookbook/index_ckbk.html" class="btn btn-neutral float-right" title="Cook Book" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="qs_GUI.html" class="btn btn-neutral" title="MOOSE GUI: Graphical interface for MOOSE" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Upinder S. Bhall, Subhasis Ray, Aditya Gilra, Dilawar Singh, Harsha Rani, Aviral Goel, Malav Shah.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'ChamCham (3.1.1)',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>